!function(e){function t(e){var t=document.implementation,o=t.createHTMLDocument("temp"),i=t.createDocument("http://www.w3.org/1999/xhtml","html",null),a=i.createElementNS("http://www.w3.org/1999/xhtml","body")
return o.body.innerHTML="<div>"+e+"</div>",i.documentElement.appendChild(a),i.importNode(o.body,!0),a.appendChild(o.body.firstChild),/<body.*?><div>([\s\S]*?)<\/div><\/body>/i.exec(i.documentElement.innerHTML),RegExp.$1}var o,i,a,n,r,l,d,c,s,u,g,p,h,m,b,f,v,w,C,y,k,x,T,E,P
editContent=function(){l.attr("contentEditable",!0),c.attr("contentEditable",!0),c.css({minHeight:"100px"}),c.parent().css("display","block"),s.wysiwyg({hotKeys:{},activeToolbarClass:"active"}),s.css({minHeight:"400px"}),"new"==i&&(l.attr("placeholder","type your title here"),c.attr("placeholder","type your meta description here"),s.attr("placeholder","type your main content here")),d.datetimepicker({debug:!1,widgetPositioning:{horizontal:"left",vertical:"bottom"},keepOpen:!0,allowInputToggle:!0}),b.attr("disabled",!0),f.attr("disabled",!0),w.removeAttr("disabled"),C.removeAttr("disabled"),"new"==i?e("#liDelete").hide():e("#liDelete").show(),e("#liSave").show(),e("#liCancel").show(),e("#liPublished").show(),"Page"==r?e("#liPageOrder").show():e("#liPageOrder").hide(),e("#liNewItem").hide(),e("#liEdit").hide(),n&&showCategoriesForEditing(),toggleSourceView(),e("#tools").fadeIn().css("display","inline-block")},cancelEdit=function(){i.length>0?confirm("Do you want to leave this page?")&&history.back():window.location=P},toggleSourceView=function(){e(".source").bind("click",function(){var t=e(this)
"source"===t.attr("data-cmd")?(t.attr("data-cmd","design"),t.addClass("active"),s.text(s.html())):(t.attr("data-cmd","source"),t.removeClass("active"),s.html(s.text()))})},saveContent=function(i){"design"===e(".source").attr("data-cmd")&&e(".source").click(),s.cleanHtml()
var a
a=t(s.html())
var n=0
"Page"==r&&(n=p.val()),e.post(T,{id:o,isPublished:h.prop("checked"),title:l.text().trim(),pubDate:d.val(),pageOrder:n,metaDescription:c.text().trim(),content:a,categories:getCategories(),__RequestVerificationToken:document.querySelector("input[name=__RequestVerificationToken]").getAttribute("value")},null,"text").success(function(e){location.href=e}).fail(function(e){409===e.status?showMessage(!1,"The title is already in use"):showMessage(!1,"Something bad happened. Server reported "+e.status+" "+e.statusText)})},deleteContent=function(){confirm("Are you sure you want to delete this "+r+"?")&&e.post(E,{id:o,__RequestVerificationToken:document.querySelector("input[name=__RequestVerificationToken]").getAttribute("value")}).success(function(){location.href=k}).fail(function(){showMessage(!1,"Something went wrong. Please try again")})},showMessage=function(e,t){var o=e?"alert-success":"alert-error"
u.addClass(o),u.text(t),u.parent().fadeIn(),setTimeout(function(){u.parent().fadeOut("slow",function(){u.removeClass(o)})},4e3)},getCategories=function(){var t=""
return e("#txtCategories").length>0?t=e("#txtCategories").val():e("ul.categories li a").each(function(o,i){t.length>0&&(t+=","),t+=e(i).html()}),t},showCategoriesForEditing=function(){var t=!1,o=getCategories()
e("ul.categories li").each(function(o,i){t?e(i).remove():t=!0}),e("ul.categories").append("<li><input id='txtCategories' class='form-control' /></li>"),e("#txtCategories").val(o),e("#txtCategories").attr("placeholder","type comma separated categories here")},showCategoriesForDisplay=function(){if(e("#txtCategories").length>0){var t=e("#txtCategories").val().split(",")
e("#txtCategories").parent().remove(),e.each(t,function(t,o){e("ul.categories").append(' <li itemprop="articleSection" title="'+o+'"> <a href="'+x+encodeURIComponent(o.toLowerCase())+'">'+o+"</a> </li> ")})}},setToolbarCookie=function(){e.cookie("editor-toggle","hide",{path:"/"})},clearToolbarCookie=function(){e.removeCookie("editor-toggle",{path:"/"})},toolBarCookieExists=function(){var t=e.cookie("editor-toggle")
return t?!0:!1},toggleToolbar=function(){var e=(m.hasClass("invisible"),m.is(":visible"))
e?(m.hide(),y.show(),y.animate({top:S,right:"0px"},500,"swing"),clearToolbarCookie()):(m.show(),y.hide(),toolBarCookieExists()||setToolbarCookie())},setInitialToggleState=function(){toolBarCookieExists()?m.show():(m.hide(),y.animate({top:S,right:"0px"},500,"swing"))},addToolBarPadding=function(){D=m.height()},removeToolbarPadding=function(){},m=e("#editor-toolbar"),r=e("#editor-toolbar").data("content-type"),"Page"==r?(o=e("article").first().attr("data-id"),l=e("#article-title"),p=e("#PageOrder")):(o=e("[itemprop~='blogPost']").attr("data-id"),l=e("[itemprop~='blogPost'] [itemprop~='name']")),c=e("[itemprop~='description']"),s=e("[itemprop~='articleBody']"),u=e("#editor-toolbar .alert"),g=e("#editor-toolbar #txtImage"),d=e("[itemprop~='datePublished']"),b=e("#btnNew"),f=e("#btnEdit"),v=e("#btnDelete").bind("click",deleteContent),w=e("#btnSave").bind("click",saveContent),C=e("#btnCancel").bind("click",cancelEdit),y=e("#editor-outer-toggle"),h=e("#published"),k=e("#editor-toolbar").data("index-path"),x=e("#editor-toolbar").data("category-path"),T=e("#editor-toolbar").data("save-path"),E=e("#editor-toolbar").data("delete-path"),P=e("#editor-toolbar").data("cancel-edit-path"),a=e("#editor-toolbar").data("current-slug"),n="True"==e("#editor-toolbar").data("supports-categories"),i=e("#editor-toolbar").data("edit-mode")
var S=e(".navbar-fixed-top").first().height(),D=m.height()
m.height()
"Post"==r&&0==a.length&&e("#liEdit").hide(),e("#btnHide").click(function(e){e.preventDefault(),toggleToolbar()}),y.click(function(e){e.preventDefault(),toggleToolbar()}),setInitialToggleState(),0==a.length,e(document).keyup(function(e){document.activeElement.isContentEditable||(46===e.keyCode?deleteContent():27===e.keyCode&&cancelEdit())}),e(".uploadimage").click(function(t){t.preventDefault(),e("#txtImage").click()}),"new"==i||"edit"==i?editContent():"Page"==r&&a&&f.removeAttr("disabled"),e(".dropdown-menu > input").click(function(e){e.stopPropagation()})}(jQuery)
