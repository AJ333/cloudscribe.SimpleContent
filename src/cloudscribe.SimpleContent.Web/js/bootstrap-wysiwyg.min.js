!function(t){"use strict"
var e=function(t,e){var n,o,a,i,r=0,l=function(){r=new Date,a=null,i=t.apply(n,o)}
return function(){var s=new Date,c=e-(s-r)
return n=this,o=arguments,0>=c?(clearTimeout(a),a=null,r=s,i=t.apply(n,o)):a||(a=setTimeout(l,c)),i}},n=function(e){var n=t.Deferred(),o=new FileReader
return o.onload=function(t){n.resolve(t.target.result)},o.onerror=n.reject,o.onprogress=n.notify,o.readAsDataURL(e),n.promise()}
t.fn.cleanHtml=function(){var e=t(this).html()
return e&&e.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},t.fn.wysiwyg=function(o){var a,i,r,l=this,s=t(l).parent(),c=function(){i.activeToolbarClass&&t(i.toolbarSelector,s).find(r).each(e(function(){var e=t(this).data(i.commandRole).split(" "),n=e[0]
e.length>1&&document.queryCommandEnabled(n)&&document.queryCommandValue(n)==e[1]?t(this).addClass(i.activeToolbarClass):1===e.length&&document.queryCommandEnabled(n)&&document.queryCommandState(n)?t(this).addClass(i.activeToolbarClass):t(this).removeClass(i.activeToolbarClass)},i.keypressTimeout))},d=function(t,e){var n=t.split(" "),o=n.shift(),a=n.join(" ")+(e||"")
document.execCommand(o,0,a),c()},u=function(e){t.each(e,function(t,e){l.keydown(t,function(t){l.attr("contenteditable")&&l.is(":visible")&&(t.preventDefault(),t.stopPropagation(),d(e))}).keyup(t,function(t){l.attr("contenteditable")&&l.is(":visible")&&(t.preventDefault(),t.stopPropagation())})})},f=function(){var t,e
return window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0))):document.selection&&(e=document.selection.createRange()),e},m=function(){a=f()},h=function(){var t
if(window.getSelection||document.createRange){if(t=window.getSelection(),a){try{t.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}t.addRange(a)}}else document.selection&&a&&a.select()},p=function(e){l.focus(),t.each(e,function(e,o){/^image\//.test(o.type)?t.when(n(o)).done(function(t){d("insertimage",t),l.trigger("image-inserted")}).fail(function(t){i.fileUploadError("file-reader",t)}):i.fileUploadError("unsupported-file-type",o.type)})},g=function(t,e){h(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,e||"transparent"),m(),t.data(i.selectionMarker,e)},y=function(e,n){e.find(r,s).click(function(){h(),l.focus(),d(t(this).data(n.commandRole)),m()}),e.find("[data-toggle=dropdown]").click(h),e.find("input[type=text][data-"+n.commandRole+"]").on("webkitspeechchange change",function(){var e=this.value
this.value="",h(),e&&(l.focus(),d(t(this).data(n.commandRole),e)),m()}).on("focus",function(){var e=t(this)
e.data(n.selectionMarker)||(g(e,n.selectionColor),e.focus())}).on("blur",function(){var e=t(this)
e.data(n.selectionMarker)&&g(e,!1)}),e.find("input[type=file][data-"+n.commandRole+"]").change(function(){h(),"file"===this.type&&this.files&&this.files.length>0&&p(this.files),m(),this.value=""})},v=function(){l.on("dragenter dragover",!1).on("drop",function(t){var e=t.originalEvent.dataTransfer
t.stopPropagation(),t.preventDefault(),e&&e.files&&e.files.length>0&&p(e.files)})}
return i=t.extend(!0,{},t.fn.wysiwyg.defaults,o),r="a[data-"+i.commandRole+"],button[data-"+i.commandRole+"],input[type=button][data-"+i.commandRole+"]",u(i.hotKeys),""!=t(this).attr("placeholder")&&(t(this).addClass("placeholderText"),t(this).html(t(this).attr("placeholder")),t(this).bind("focus",function(e){""!=t(this).attr("placeholder")&&t(this).text()==t(this).attr("placeholder")&&(t(this).removeClass("placeholderText"),t(this).html(""))}),t(this).bind("blur",function(e){""!=t(this).attr("placeholder")&&""==t(this).text()&&(t(this).addClass("placeholderText"),t(this).html(t(this).attr("placeholder")))})),i.dragAndDropImages&&v(),y(t(i.toolbarSelector),i),l.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){m(),c()}),t(window).bind("touchend",function(t){var e=l.is(t.target)||l.has(t.target).length>0,n=f(),o=n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset;(!o||e)&&(m(),c())}),this},t.fn.wysiwyg.defaults={hotKeys:{"Ctrl+b meta+b":"bold","Ctrl+i meta+i":"italic","Ctrl+u meta+u":"underline","Ctrl+z":"undo","Ctrl+y meta+y meta+shift+z":"redo","Ctrl+l meta+l":"justifyleft","Ctrl+r meta+r":"justifyright","Ctrl+e meta+e":"justifycenter","Ctrl+j meta+j":"justifyfull","Shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,keypressTimeout:200,fileUploadError:function(t,e){console.log("File upload error",t,e)}}}(window.jQuery)
